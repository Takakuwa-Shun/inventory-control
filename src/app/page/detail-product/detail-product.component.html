<div class="container-fluid">
  <app-sub-header
  [title]="product.name"
  [showPrint]=true
  [showCsv]=false
  [showImage]=true
  [iconImageUrl]=imageSrc
  ></app-sub-header>
  <div class="table-responsive">
    <form (ngSubmit)="submit()" #productForm="ngForm">
      <table class="table table-sm table-bordered">
        <thead class="thead-light">
          <tr>
            <th scope="col">項目</th>
            <th scope="col">値</th>
            <th scope="col">編集欄</th>
          </tr>
        </thead>
        <tbody>  
          <tr>
            <th scope="col">商品名</th>
            <td>{{product.name}}</td>
            <td>
              <div class="form-group">
                <input
                type="text"
                class="form-control"
                id="name"
                [(ngModel)]="registerProduct.name"
                name="name"
                #name="ngModel"
                required>
                <div class="alert alert-danger" *ngIf="name.errors && (name.dirty || name.touched)">
                  <div [hidden]="!name.errors.required">※ 項目が未入力です</div>
                </div>
              </div>
            </td>
          </tr>
          <tr>
            <th scope="col">商品名かな</th>
            <td>{{product.nameKana}}</td>
            <td>
              <div class="form-group">
                <input
                type="text"
                class="form-control"
                id="nameKana"
                [(ngModel)]="registerProduct.nameKana"
                name="nameKana"
                #nameKana="ngModel"
                required
                pattern="{{nameKanaPattern}}">
                <div class="alert alert-danger" *ngIf="nameKana.errors && (nameKana.dirty || nameKana.touched)">
                  <div [hidden]="!nameKana.errors.required">※ 項目が未入力です</div>
                  <div [hidden]="!nameKana.errors.pattern">※ 全角かな・半角英数字・半角記号・半角スペース以外は入力しないでください</div>
                </div>
              </div>
            </td>
          </tr>
          <tr>
            <th scope="col">商品入り数</th>
            <td>{{product.lot}}</td>
            <td>
              <div class="form-group">
                <input
                type="text"
                class="form-control"
                id="lot"
                [(ngModel)]="registerProduct.lot"
                name="lot"
                placeholder="商品入り数を入力してください"
                aria-describedby="lotHelp"
                #lot="ngModel"
                required
                pattern="{{countPattern}}">
                <div class="alert alert-danger" *ngIf="lot.errors && (lot.dirty || lot.touched)">
                  <div [hidden]="!lot.errors.required">※ 項目が未入力です</div>
                  <div [hidden]="!lot.errors.pattern">※ １以上の半角数字で入力してください</div>
                </div>
                <small id="lotHelp" class="form-text text-muted">指定がない場合、1を設定して下さい</small>
              </div>
            </td>
          </tr>
          <tr>
            <th scope="col">ボトル名</th>
            <td><a routerLink="/material/detail/bottle/{{product.bottleId}}">{{product.bottleName}}</a></td>
            <td>
              <div class="form-group">
                <input
                ngui-auto-complete
                id="bottle"
                class="form-control"
                [source]="bottleLists"
                [list-formatter]="autocompleListFormatter.bind(this)"
                loading-text="検索中"
                no-match-found-text="該当するボトルはありません。"
                placeholder="ボトル名を検索してください"
                display-property-name="name"
                min-chars=0
                auto-select-first-item="true"
                (valueChanged)="selectMaterial($event, 'bottle')"
                autocomplete="off"
                >
                <div class="alert alert-danger" *ngIf="showBottleAlert">
                  ※ 検索結果候補から選択してください
                </div>
                <span *ngIf="!isBottleSelected" class="badge badge-danger">未選択</span>
                <div *ngIf="isBottleSelected">
                  <span class="badge badge-success">選択中</span>
                  <span class="auto-selected ml-2">{{registerProduct.bottleData.name }}</span>
                  <span class="pointer ml-2" style="color: red" (click)="cancelMaterialSelected('bottle')" title="キャンセル">
                    <fa-icon [icon]="['fas', 'times']"></fa-icon>
                  </span>
                </div>
              </div>
            </td>
          </tr>
          <tr>
            <th scope="col">カートン名</th>
            <td><a routerLink="/material/detail/carton/{{product.cartonId}}">{{product.cartonName}}</a></td>
            <td>
              <div class="form-group">
                <input
                ngui-auto-complete
                id="carton"
                class="form-control"
                [source]="cartonLists"
                [list-formatter]="autocompleListFormatter.bind(this)"
                loading-text="検索中"
                no-match-found-text="該当するカートンはありません。"
                placeholder="カートン名を検索してください"
                display-property-name="name"
                min-chars=0                 
                auto-select-first-item="true"
                (valueChanged)="selectMaterial($event, 'carton')"
                autocomplete="off"
                >
                <div class="alert alert-danger" *ngIf="showCartonAlert">
                  ※ 検索結果候補から選択してください
                </div>
                <span *ngIf="!isCartonSelected" class="badge badge-danger">未選択</span>
                <div *ngIf="isCartonSelected">
                  <span class="badge badge-success">選択中</span>
                  <span class="auto-selected ml-2">{{registerProduct.cartonData.name }}</span>
                  <span class="pointer ml-2" style="color: red" (click)="cancelMaterialSelected('carton')" title="キャンセル">
                    <fa-icon [icon]="['fas', 'times']"></fa-icon>
                  </span>
                </div>
              </div>
            </td>
          </tr>
          <tr>
            <th scope="col">ラベル名</th>
            <td><a routerLink="/material/detail/label/{{product.labelId}}">{{product.labelName}}</a></td>
            <td>
              <div class="form-group">
                <input
                ngui-auto-complete
                id="label"
                class="form-control"
                [source]="labelLists"
                [list-formatter]="autocompleListFormatter.bind(this)"
                loading-text="検索中"
                no-match-found-text="該当するラベルはありません。"
                placeholder="ラベル名を検索してください"
                display-property-name="name"
                min-chars=0                 
                auto-select-first-item="true"
                (valueChanged)="selectMaterial($event, 'label')"
                autocomplete="off"
                >
                <div class="alert alert-danger" *ngIf="showLabelAlert">
                  ※ 検索結果候補から選択してください
                </div>
                <span *ngIf="!isLabelSelected" class="badge badge-danger">未選択</span>
                <div *ngIf="isLabelSelected">
                  <span class="badge badge-success">選択中</span>
                  <span class="auto-selected ml-2">{{registerProduct.labelData.name }}</span>
                  <span class="pointer ml-2" style="color: red" (click)="cancelMaterialSelected('label')" title="キャンセル">
                    <fa-icon [icon]="['fas', 'times']"></fa-icon>
                  </span>
                </div>
              </div>
            </td>
          </tr>
          <tr>
            <th scope="col">トリガー名</th>
            <td><a routerLink="/material/detail/trigger/{{product.triggerId}}">{{product.triggerName}}</a></td>
            <td>
              <div class="form-group">
                <input
                ngui-auto-complete
                id="trigger"
                class="form-control"
                [source]="triggerLists"
                [list-formatter]="autocompleListFormatter.bind(this)"
                loading-text="検索中"
                no-match-found-text="該当するトリガーはありません。"
                placeholder="トリガー名を検索してください"
                display-property-name="name"
                min-chars=0                 
                auto-select-first-item="true"
                (valueChanged)="selectMaterial($event, 'trigger')"
                autocomplete="off"
                >
                <div class="alert alert-danger" *ngIf="showTriggerAlert">
                  ※ 検索結果候補から選択してください
                </div>
                <span *ngIf="!isTriggerSelected" class="badge badge-danger">未選択</span>
                <div *ngIf="isTriggerSelected">
                  <span class="badge badge-success">選択中</span>
                  <span class="auto-selected ml-2">{{registerProduct.triggerData.name }}</span>
                  <span class="pointer ml-2" style="color: red" (click)="cancelMaterialSelected('trigger')" title="キャンセル">
                    <fa-icon [icon]="['fas', 'times']"></fa-icon>
                  </span>
                </div>
              </div>
            </td>
          </tr>
          <tr>
            <th scope="col">詰め替え袋名</th>
            <td><a routerLink="/material/detail/bag/{{product.bagId}}">{{product.bagName}}</a></td>
            <td>
              <div class="form-group">
                <input
                ngui-auto-complete
                id="bag"
                class="form-control"
                [source]="bagLists"
                [list-formatter]="autocompleListFormatter.bind(this)"
                loading-text="検索中"
                no-match-found-text="該当する詰め替え袋はありません。"
                placeholder="詰め替え袋名を検索してください"
                display-property-name="name"
                min-chars=0                 
                auto-select-first-item="true"
                (valueChanged)="selectMaterial($event, 'bag')"
                autocomplete="off"
                >
                <div class="alert alert-danger" *ngIf="showBagAlert">
                  ※ 検索結果候補から選択してください
                </div>
                <span *ngIf="!isBagSelected" class="badge badge-danger">未選択</span>
                <div *ngIf="isBagSelected">
                  <span class="badge badge-success">選択中</span>
                  <span class="auto-selected ml-2">{{registerProduct.bagData.name }}</span>
                  <span class="pointer ml-2" style="color: red" (click)="cancelMaterialSelected('bag')" title="キャンセル">
                    <fa-icon [icon]="['fas', 'times']"></fa-icon>
                  </span>
                </div>
              </div>
            </td>
          </tr>
          <tr>
            <th scope="col">得意先名</th>
            <td><a routerLink="/company/detail/{{product.companyId}}">{{product.companyName}}</a></td>
            <td>
              <div class="form-group">
                <input
                ngui-auto-complete
                id="company"
                class="form-control"
                [source]="companyLists"
                [list-formatter]="autocompleListFormatter.bind(this)"
                loading-text="検索中"
                no-match-found-text="該当する得意先はありません。"
                placeholder="得意先名を検索してください"
                display-property-name="name"
                min-chars=0                 
                auto-select-first-item="true"
                (valueChanged)="selectMaterial($event, 'company')"
                autocomplete="off"
                >
                <div class="alert alert-danger" *ngIf="showCompanyAlert">
                  ※ 検索結果候補から選択してください
                </div>
                <span *ngIf="!isCompanySelected" class="badge badge-danger">未選択</span>
                <div *ngIf="isCompanySelected">
                  <span *ngIf="isCompanySelected" class="badge badge-success">選択中</span>
                  <span class="auto-selected ml-2">{{registerProduct.companyData.name }}</span>
                  <span class="pointer ml-2" style="color: red" (click)="cancelMaterialSelected('company')" title="キャンセル">
                    <fa-icon [icon]="['fas', 'times']"></fa-icon>
                  </span>
                </div>
              </div>
            </td>
          </tr>
          <tr>
            <th scope="col">商品写真</th>
            <td>      
              <img class="show-icon img-thumbnail rounded img-fluid" [src]="imageSrc" alt="読み込みエラー">
            </td>
            <td>下記から画像の登録・修正が可能です。</td>
          </tr>
        </tbody>
      </table>
      <app-image-cropper-wrapper
        inputTitle="画像修正"
        [_isInited]="isInitInputImage"
        (loadFailed)="imageLoadFailed()"
        (cropped)="selectImage($event)"
      ></app-image-cropper-wrapper>
      <div class="row">
        <div class="mx-auto">
          <button class="btn btn-outline-dark" (click)="goBack()">商品一覧へ</button>
        </div>
        <div class="mx-auto">
          <button
          type="button"
          class="btn btn-primary"
          data-toggle="modal"
          data-target="#Modal"
          (click)="createBody()"
          [disabled]="!productForm.form.valid">修正</button>
        </div>
        <div class="mx-auto">
          <button
          type="button"
          class="btn btn-danger"
          data-toggle="modal"
          data-target="#DeleteModal">削除</button>
        </div>
      </div>
    </form>
  </div>
</div>
<app-confirm-modal
[title]="confirmTitle"
[bodyHtml]="confirmBody"
[btnCancel]="confirmCancelBtn"
[btnAction]="confirmActionBtn"
(action)="submit()"
></app-confirm-modal>
<app-simple-modal
[body]="deleteBody"
[btn]="deleteBtn"
[btnType]="deleteBtnType"
[modalId]="deleteModal"
(action)="delete()">
</app-simple-modal>